#!/bin/sh
# check for an option --prefix=/path/to/prefix and use that as the prefix, otherwise use /usr/local
# calls configure scripts for valgrind and STP
PREFIX=/usr/local

while [ $# -gt 0 ]; do
    case "$1" in
	--prefix=*)
	    arg=`expr "x$1" : 'x[^=]*=\(.*\)'`
	    PREFIX=$arg;;
	*)
	    echo "Usage: configure [options]"
	    echo "   --prefix=/prefix/path   Install avalanche at the specified path"
	    echo "configure failed"
	    exit 1;;
    esac

    shift
done

echo "PREFIX=$PREFIX" > config.info
echo "Setting prefix to... $PREFIX"

if [ ! -d $PREFIX ]
then mkdir $PREFIX
fi

if cd stp-ver-0.1-11-18-2008 && ./configure --with-prefix=$PREFIX && cd ..
then
echo "STP successfully configured"
else
echo "Failed to configure STP"
exit 1
fi

if cd valgrind && ./autogen.sh && ./configure --prefix=$PREFIX && cd ..
then
echo "Valgrind successfully configured"
else
echo "Failed to configure Valgrind"
exit 1
fi

echo "Avalanche is configured successfully."

echo "Type 'make' to compile and install Avalanche"
